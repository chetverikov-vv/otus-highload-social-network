## Отчет о выполнении HW-4

### Текст задания в файле [HW-4.md](HW-4.md)

Что сделано при выполнении:

- Создан сервис диалогов в виде отдельного Gradle модуля dialogs в рамках проекта.
- В сервисе диалогов реализованы методы /dialog/{user_id}/send и /dialog/{user_id}/list.
- Монолитное приложение перенесено в отдельный Gradle модуль mono.
- В монолитном приложении реализованы методы диалогов, которые обращаются через REST API к сервису диалогов.
- организовано сквозное логирование для методов диалога с использованием заголовка request-id в обоих сервисах.

Таким образом, в соответствии с заданием:

- Система диалогов вынесена в отдельный сервис.
- Реализована поддержка клиентов, которые используют старое API (через монолит) и новых (через сервис диалогов).
- Взаимодействия монолитного сервиса и сервиса чатов реализованы на Rest API.
- Организовано сквозное логирование запросов.

### Инструкция по запуску

Выполнить сборку проекта. Для этого необходимо выполнить команду из корня проекта
(в первый раз занимает длительное время из-за загрузки дополнительных образов для сборки)

- Для windows (PowerShell): `.\gradlew.bat clean bootBuildImage`
- Для Linux `gradlew clean bootBuildImage`

Указанная команда с помощью Gradle выполнит сборку модулей mono (монолит) и dialogs (сервис диалогов),
результат сборки каждого модуля упакует в docker image, которые будут находиться в локальном репозитории docker образов.

Проверить, что собранные образы появились в списке образов командой `docker image ls`:

- vchetverikov/social-network-mono:latest
- vchetverikov/social-network-dialogs:latest

Для запуска будет использоваться docker-compose. Файл расположен в `/docker/docker-compose.yml`

Перейти в директорию docker и выполнить команду `docker-compose up`. Дождаться запуска всех компонентов.
После запуска сервис монолит (mono) доступен по адресу `localhost:8080`, сервис диалогов (dialogs) - по
адресу `localhost:8081`

Можно начинать проверку, описанную далее.

### Инструкция по проверке

Импортировать postman коллекцию [../postman/HW-4.postman_collection.json](../postman/HW-4.postman_collection.json)
и запустить ее на выполнение.

Что делает коллекция:

- Регистрирует и логинит двух пользователей.
  Идентификаторы пользователей и bearer токены для дальнейших запросов сохраняются в переменных коллекции.
- Отправляет последовательно 4 сообщения:
  - От первого второму через старое API (в сервисе mono)
  - От второго первому через старое API (в сервисе mono)
  - От первого второму через новое API (в сервисе dialogs)
  - От второго первому через новое API (в сервисе dialogs)
- В результате выполнения предыдущих запросов между пользователями получился диалог из 4 сообщений.
  Далее выполняется 4 запроса на получение диалога между этими пользователями:
  - От лица первого пользователя через старое API (в сервисе mono)
  - От лица первого пользователя через новое API (в сервисе dialogs)
  - От лица второго пользователя через старое API (в сервисе mono)
  - От лица второго пользователя через новое API (в сервисе dialogs)

Все 4 запроса на получение диалога имеют одинаковый вывод из 4 сообщений в правильной последовательности - от старого к
новому.
Пример ответа на один из 4 запросов получения диалога:

```
[{
"from": "bf1365a8-86d3-4609-9544-12ea9c230f82",
"to": "a9f07543-9f34-4c9c-aacf-1792a92d3b76",
"text": "Сообщение №1 от первого пользователя: Привет второй пользователь!"
}, {
"from": "a9f07543-9f34-4c9c-aacf-1792a92d3b76",
"to": "bf1365a8-86d3-4609-9544-12ea9c230f82",
"text": "Сообщение №1 от второго пользователя: Привет первый пользователь!"
}, {
"from": "bf1365a8-86d3-4609-9544-12ea9c230f82",
"to": "a9f07543-9f34-4c9c-aacf-1792a92d3b76",
"text": "Сообщение №2 от первого пользователя: Как дела второй пользователь?"
}, {
"from": "a9f07543-9f34-4c9c-aacf-1792a92d3b76",
"to": "bf1365a8-86d3-4609-9544-12ea9c230f82",
"text": "Сообщение №2 от второго пользователя: Нормально, первый пользователь!"
}]
```
